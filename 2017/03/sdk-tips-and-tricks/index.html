<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="zh-Hans-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>修改 CoreOS: 提示和技巧 | Gitai.me</title>

<meta property='og:title' content='修改 CoreOS: 提示和技巧 - Gitai.me'>
<meta property='og:description' content='找到所有打开的请求和问题

CoreOS Issues
CoreOS Pull Requests
'>
<meta property='og:url' content='https://gitai.me/2017/03/sdk-tips-and-tricks/'>
<meta property='og:site_name' content='Gitai.me'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/d277f292abb792ca53d809be58cb3d85?s=256'><meta property='article:section' content='Posts'><meta property='article:tag' content='CoreOS'><meta property='article:tag' content='Docker'><meta property='article:tag' content='记录'><meta property='article:published_time' content='2017-03-21T01:06:19Z'/><meta property='article:modified_time' content='2017-03-21T01:06:19Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@_gitai'><meta name='twitter:creator' content='@_gitai'>


<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://gitai.me/2017/03/sdk-tips-and-tricks/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://gitai.me/">
          
            <img class="logo" src="/img/logo.gif" alt="Gitai.me"/>
          
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/GitaiQAQ'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/_gitai'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:i@gitai.me'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <div class="dividing-line"></div>
    <div class="content">
      <blockquote>
        <p>
          系统更换中，可能存在不可预料的 BUG
        </p>
      </blockquote>
    </div>

    

  </div>
  
</section>
<article>
  <section class="left-menu ">
</section>
  <section class="section">
    <div class="container">
      <div class="subtitle tags is-6 is-pulled-right">
        
        
<a class="subtitle is-6" href="/tags/coreos/">#CoreOS</a>



  
  | <a class="subtitle is-6" href="/tags/docker/">#Docker</a>
  
  | <a class="subtitle is-6" href="/tags/%E8%AE%B0%E5%BD%95/">#记录</a>
  


        
      </div>
      <h2 class="subtitle is-6">March 21, 2017</h2>
      <h1 class="title">修改 CoreOS: 提示和技巧</h1>
      
      <div class="content">
        <h2 id="找到所有打开的请求和问题">找到所有打开的请求和问题</h2>
<ul>
<li><a href="https://github.com/issues?user=coreos">CoreOS Issues</a></li>
<li><a href="https://github.com/pulls?user=coreos">CoreOS Pull Requests</a></li>
</ul>
<h2 id="搜索所有-repo-中的代码">搜索所有 repo 中的代码</h2>
<p>使用 <code>repo forall</code>,您可以搜索所有的 Git repo</p>
<pre><code>repo forall -c  git grep 'CONFIG_EXTRA_FIRMWARE_DIR'
</code></pre><p>注意:这个可能需要一些时间。</p>
<h2 id="基本系统依赖图">基本系统依赖图</h2>
<p>获取基本系统将包含的内容以及为什么它将包含那些具有emerge树视图的东西：</p>
<pre><code>emerge-amd64-usr --emptytree -p -v --tree coreos-base/coreos-dev
</code></pre><h2 id="添加新的上游包">添加新的上游包</h2>
<p>关于为Container Linux提供新软件包的概述：</p>
<ul>
<li>为工作创建一个git分支</li>
<li>从上游（Gentoo）获取目标包</li>
<li>对Container Linux进行任何必要的更改</li>
<li>添加软件包作为coreos-base / coreos的依赖</li>
<li>构建包并测试</li>
<li>提交更改为git</li>
<li>将分支推送到您的GitHub帐户并创建一个pull请求</li>
</ul>
<p>推送前请参阅 <a href="https://github.com/coreos/etcd/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> 了解准则。</p>
<p>使用以下 Container Linux 存储库：</p>
<ul>
<li>将在 <code>src/third_party/portage-stable</code> 中对未修改的软件包进行版本控制</li>
<li>带有 Container 的包 - Linux 特定的更改在 <code>src/third_party/coreos-overlay</code> 中进行版本控制</li>
</ul>
<p>在进行任何更改之前，使用 <code>repo start</code> 创建工作分支</p>
<pre><code>~/trunk/src/scripts $ repo start my_package_update --all 
</code></pre><p>您可以使用 <code>scripts/update_ebuilds</code> 将未修改的软件包提取到 <code>src/third_party/portage-stable</code> 并将文件添加到 git。 package 参数的格式应为 <code>category/package-name</code> ，例如：</p>
<pre><code>~/trunk/src/scripts $ ./update_ebuilds sys-block/open-iscsi
</code></pre><p>修改后的包必须从 <code>src/third_party/portage-stable</code> 移出到 <code>src/third_party/coreos-overlay</code>。</p>
<p>如果您事先知道上游包中的任何文件将需要更改，该包可以从上游 Gentoo 直接提取到 <code>src/third_party/coreos-overlay</code>。</p>
<p>例如：</p>
<pre><code>~/trunk/src/third_party/coreos-overlay $ mkdir -p sys-block/open-iscsi
~/trunk/src/third_party/coreos-overlay $ rsync -av rsync://rsync.gentoo.org/gentoo-portage/sys-block/open-iscsi/ sys-block/open-iscsi/
</code></pre><p>从创建的软件包文件夹同步，所以你不能用 <code>sys-block/open-iscsi/open-iscsi</code> 结束它。</p>
<p>快速测试新软件包，使用以下命令</p>
<pre><code>~/trunk/src/scripts $ # Manually merge a package in the chroot
~/trunk/src/scripts $ emerge-amd64-usr packagename
~/trunk/src/scripts $ # Manually unmerge a package in the chroot
~/trunk/src/scripts $ emerge-amd64-usr --unmerge packagename
~/trunk/src/scripts $ # Remove a binary from the cache
~/trunk/src/scripts $ sudo rm /build/amd64-usr/packages/catagory/packagename-version.tbz2
</code></pre><p>要在干净重建之前重新创建chroot，请退出chroot并运行：</p>
<pre><code>~/coreos $ ./chromite/bin/cros_sdk -r
</code></pre><p>要将新包作为Container Linux的依赖关系，请将该包添加到 <code>coreos-base/coreos/coreos-0.0.1.ebuild</code> 中的 RDEPEND 环境变量的末尾，然后通过重命名软链接来增加 Container Linux 的版本 ）：</p>
<pre><code>~/trunk/src/third_party/coreos-overly $ git mv coreos-base/coreos/coreos-0.0.1-r237.ebuild coreos-base/coreos/coreos-0.0.1-r238.ebuild
</code></pre><p>当再次运行 build_packages 时，新软件包将作为正常构建流程的一部分进行构建和安装。</p>
<p>如果测试成功，提交更改，推送到您的 GitHub fork 并创建一个 pull 请求。</p>
<h2 id="打包参考">打包参考</h2>
<p>参考文献</p>
<ul>
<li>Chromium OS <a href="http://www.chromium.org/chromium-os/how-tos-and-troubleshooting/portage-build-faq">Portage Build FAQ</a></li>
<li><a href="http://devmanual.gentoo.org/">Gentoo Development Guide</a></li>
<li><a href="https://wiki.gentoo.org/wiki/Package_Manager_Specification">Package Manager Specification</a></li>
</ul>
<h2 id="缓存-git-https-密码">缓存 git https 密码</h2>
<p>打开凭证助手，git会在内存中保存您的密码一段时间：</p>
<pre><code>git config --global credential.helper cache
</code></pre><p>注意：您需要 git 1.7.10 或更高版本才能使用凭据助手</p>
<p>为什么 Container Linux 在 git 远程数据库中使用 SSH？ 因为我们不能使用 SSH URL 从 GitHub 做匿名克隆。 这将最终固定。</p>
<h2 id="ssh-配置">SSH 配置</h2>
<p>你将引导大量的虚拟机与即时ssh密钥生成。 将它添加到您的 <code>$HOME/.ssh/config</code> 中，以停止恼人的指纹警告。</p>
<pre><code>Host 127.0.0.1
  StrictHostKeyChecking no
  UserKnownHostsFile /dev/null
  User core
  LogLevel QUIET
</code></pre><h2 id="从桌面环境中隐藏环路设备">从桌面环境中隐藏环路设备</h2>
<p>默认情况下，桌面环境会努力显示所有已安装的设备，包括用于构建Container Linux磁盘映像的环路设备。 如果负责此守护程序的守护程序恰好是udisks，那么您可以使用以下udev规则禁用此行为：</p>
<pre><code>echo 'SUBSYSTEM==&quot;block&quot;, KERNEL==&quot;ram*|loop*&quot;, ENV{UDISKS_PRESENTATION_HIDE}=&quot;1&quot;, ENV{UDISKS_PRESENTATION_NOPOLICY}=&quot;1&quot;' &gt; /etc/udev/rules.d/85-hide-loop.rules
udevadm control --reload
</code></pre><h2 id="离开开发者模式">离开开发者模式</h2>
<p>一些守护进程在“开发模式”中的行为不同。 例如，update_engine拒绝自动更新或连接到HTTPS网址。 如果你需要在vm上测试dev_mode的东西，你可以这样做：</p>
<pre><code>mv /root/.dev_mode{,.old}
</code></pre><p>如果你想永久离开你可以运行以下：</p>
<pre><code>crossystem disable_dev_request=1; reboot
</code></pre><h2 id="已知的问题">已知的问题</h2>
<h3 id="build_packages-在-coreos-base-上失败">build_packages 在 coreos-base 上失败</h3>
<p>有时 coreos-dev 或 coreos builds 会在 build_packages 中失败，并且 backtrace 指向 epoll。 这没有被跟踪，但运行 build_packages 应该修复它。 错误看起来像这样：</p>
<pre><code>Packages failed:
coreos-base/coreos-dev-0.1.0-r63
coreos-base/coreos-0.0.1-r187
</code></pre><h3 id="新添加的包无法检查内核源">新添加的包无法检查内核源</h3>
<p>如果构建失败，可能有必要从ebuild注释掉内核源代码检查，因为Container Linux在构建时尚未提供配置的内核源代码的可见性。 通常这不是问题，但可能导致警告消息。</p>
<h2 id="常量和id">常量和ID</h2>
<h3 id="coreos容器linux应用程序id">CoreOS容器Linux应用程序ID</h3>
<p>此UUID用于将Container Linux标识为更新服务和其他位置。</p>
<pre><code>e96281a6-d1af-4bde-9a0a-97b76e56dc57
</code></pre><h3 id="gpt-uuid类型">GPT UUID类型</h3>
<p>CoreOS根：5dfbf5f4-2848-4bac-aa5e-0d9a20b745a6
CoreOS保留：c95dc21a-df0e-4340-8d7b-26cbfa9a03e0</p>
        
        <div class="related">
</div>
        
      </div>
      
    </div>
    
<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
  
    <script type="text/javascript">
      var disqus_shortname = 'gitaisblog';
      function disqus() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }
  
      disqus();
  

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


  </section>
  <section class="right-menu ">
    <div class="TableOfContents">
        
            <label><svg style="height: 1.5em; vertical-align: middle;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M576 256 96 256C76.8 256 64 243.2 64 224s12.8-32 32-32l480 0c19.2 0 32 12.8 32 32S595.2 256 576 256z" p-id="2531" fill="#2c2c2c"></path><path d="M576 544 96 544c-19.2 0-32-12.8-32-32s12.8-32 32-32l480 0c19.2 0 32 12.8 32 32S595.2 544 576 544z" p-id="2532" fill="#2c2c2c"></path><path d="M928 832 96 832c-19.2 0-32-12.8-32-32s12.8-32 32-32l832 0c19.2 0 32 12.8 32 32S947.2 832 928 832z" p-id="2533" fill="#2c2c2c"></path><path d="M768 544c-9.6 0-16-3.2-22.4-9.6-12.8-12.8-9.6-32 3.2-44.8l134.4-121.6-134.4-121.6c-12.8-12.8-12.8-32-3.2-44.8 12.8-12.8 32-12.8 44.8-3.2l160 144c6.4 6.4 9.6 16 9.6 22.4s-3.2 19.2-9.6 22.4l-160 144C784 540.8 774.4 544 768 544z" p-id="2534" fill="#2c2c2c"></path></svg>&nbsp;&nbsp;What's on this page</label>
            <div class="TableOfContents">
                <nav id="TableOfContents">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#找到所有打开的请求和问题">找到所有打开的请求和问题</a></li>
    <li><a href="#搜索所有-repo-中的代码">搜索所有 repo 中的代码</a></li>
    <li><a href="#基本系统依赖图">基本系统依赖图</a></li>
    <li><a href="#添加新的上游包">添加新的上游包</a></li>
    <li><a href="#打包参考">打包参考</a></li>
    <li><a href="#缓存-git-https-密码">缓存 git https 密码</a></li>
    <li><a href="#ssh-配置">SSH 配置</a></li>
    <li><a href="#从桌面环境中隐藏环路设备">从桌面环境中隐藏环路设备</a></li>
    <li><a href="#离开开发者模式">离开开发者模式</a></li>
    <li><a href="#已知的问题">已知的问题</a>
      <ul>
        <li><a href="#build_packages-在-coreos-base-上失败">build_packages 在 coreos-base 上失败</a></li>
        <li><a href="#新添加的包无法检查内核源">新添加的包无法检查内核源</a></li>
      </ul>
    </li>
    <li><a href="#常量和id">常量和ID</a>
      <ul>
        <li><a href="#coreos容器linux应用程序id">CoreOS容器Linux应用程序ID</a></li>
        <li><a href="#gpt-uuid类型">GPT UUID类型</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </nav>
            </div>
        
    </div>
    
</section>
</article>

    <script src="/js/copycode.js"></script>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/GitaiQAQ">Gitai</a> 2011</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

